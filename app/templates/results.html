{% extends "layout.html" %}

{% block head %}
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
	integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
	crossorigin="">
</script>
{{super()}}
{% endblock %}

{% block styles %}
{{super()}}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
      crossorigin=""/>
{% endblock %}

{% block content %}
<div class="container">
  <h3>Results</h3>
  <div class="row">
    <div id="map" style="width: 100%; 
			 height: 400px;"></div>
    <script src="{{ url_for('static', filename='js/basemap.js') }}"></script>

  </div>
  <div class="row">
    {% if result|length > 0 %}
    <table class="highlight hoverable responsive-table">
      <thead class="thead-dark">
	<tr>
	  <th scope="col">Title</th>
	  <th scope="col">Authorship</th>	  
	  <th scope="col">Project</th>
	  <th scope="col">Year</th>
          <th scope="col">Project URL</th>
	  <th scope="col" style="text-align:center">Object Type</th>
	  <th scope="col">View</th>
	</tr>
      </thead>
      <tbody>
	{% for r in result %}
	<script type="text/javascript">
	  marker = new L.marker([{{ r['metadata']['asset']['coordinates']['latitude'] }}, {{ r['metadata']['asset']['coordinates']['longitude'] }}])
    .addTo(mymap)
    .bindPopup("{{ r['metadata']['asset']['title'] }}");
	</script>
	<tr>
	  <td>{{ r['metadata']['asset']['title'] }}</td>
	  <td>{{ r['metadata']['asset']['authorship'] }}</td>
	  <td>{{ r['metadata']['project']['name'] }}</td>
	  <td>{{ r['metadata']['project']['year'] }}</td>
	  {% if r['project_url'] %}
	  <td><a class="waves-effect waves-teal btn-flat" target="_blank" href="{{ r['project_url'] }}"><i class="material-icons">link</i></a></td>
	  {% else %}
	  <td><a class="waves-effect waves-teal btn-flat"><i class="material-icons">link_off</i></a></td>
	  {% endif %}
	  {% if r['objectdata']['type'] == '3dmodel' %}
	  <td style="text-align:center"><i class="material-icons">view_in_ar</i></td>
	  <td><a class="waves-effect waves-light btn" href="{{ url_for('getObj', ID=r['_id']) }}"><i class="material-icons">visibility</i></a></td>
	  {% elif r['objectdata']['type'] == 'image'  %}
	  <td style="text-align:center"><i class="material-icons">image</i></td>
	  <td><a class="waves-effect waves-light btn" href="{{ url_for('getImg', ID=r['_id']) }}"><i class="material-icons">visibility</i></a></td>
	  {% elif r['objectdata']['type'] == 'publication' %}
	  <td style="text-align:center"><i class="material-icons">picture_as_pdf</i></td>
	  <td><a class="waves-effect waves-light btn" href="{{ url_for('getPub', ID=r['_id']) }}"><i class="material-icons">visibility</i></a></td>
	  {% endif %}
	</tr>
	{% endfor %}
	{% else %}
	<div class="row container">
	  <div class="section">
	    <div class="card amber z-depth-3">
	      <div class="card-content black-text">
		<span class="card-title">No results!</span>
		<p>Sorry but we have no results for your search query.</p>
	      </div>
	    </div>
	  </div>
	</div>
	{% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
